{"version":3,"file":"index.js","sources":["../src/html-flip-book/index.tsx"],"sourcesContent":["import React, {\n    ReactElement,\n    useCallback,\n    useEffect,\n    useImperativeHandle,\n    useRef,\n    useState,\n} from 'react';\n\nimport { PageFlip } from 'page-flip';\nimport { IFlipSetting, IEventProps } from './settings';\n\ninterface IProps extends IFlipSetting, IEventProps {\n    className: string;\n    style: React.CSSProperties;\n    children: React.ReactNode;\n    renderOnlyPageLengthChange?: boolean;\n}\n\nconst HTMLFlipBookForward = React.forwardRef(\n    (props: IProps, ref: React.MutableRefObject<PageFlip>) => {\n        const htmlElementRef = useRef<HTMLDivElement>(null);\n        const childRef = useRef<HTMLElement[]>([]);\n        const pageFlip = useRef<PageFlip>();\n\n        const [pages, setPages] = useState<ReactElement[]>([]);\n\n        useImperativeHandle(ref, () => ({\n            pageFlip: () => pageFlip.current,\n        }));\n\n        const refreshOnPageDelete = useCallback(() => {\n            if (pageFlip.current) {\n                pageFlip.current.clear();\n            }\n        }, []);\n\n        const removeHandlers = useCallback(() => {\n            const flip = pageFlip.current;\n\n            if (flip) {\n                flip.off('flip');\n                flip.off('changeOrientation');\n                flip.off('changeState');\n                flip.off('init');\n                flip.off('update');\n            }\n        }, []);\n\n        useEffect(() => {\n            childRef.current = [];\n\n            if (props.children) {\n                const childList = React.Children.map(props.children, (child) => {\n                    return React.cloneElement(child as ReactElement, {\n                        ref: (dom) => {\n                            if (dom) {\n                                childRef.current.push(dom);\n                            }\n                        },\n                    });\n                });\n\n                if (!props.renderOnlyPageLengthChange || pages.length !== childList.length) {\n                    if (childList.length < pages.length) {\n                        refreshOnPageDelete();\n                    }\n\n                    setPages(childList);\n                }\n            }\n            // eslint-disable-next-line react-hooks/exhaustive-deps\n        }, [props.children]);\n\n        useEffect(() => {\n            const setHandlers = () => {\n                const flip = pageFlip.current;\n\n                if (flip) {\n                    if (props.onFlip) {\n                        flip.on('flip', (e: unknown) => props.onFlip(e));\n                    }\n\n                    if (props.onChangeOrientation) {\n                        flip.on('changeOrientation', (e: unknown) => props.onChangeOrientation(e));\n                    }\n\n                    if (props.onChangeState) {\n                        flip.on('changeState', (e: unknown) => props.onChangeState(e));\n                    }\n\n                    if (props.onInit) {\n                        flip.on('init', (e: unknown) => props.onInit(e));\n                    }\n\n                    if (props.onUpdate) {\n                        flip.on('update', (e: unknown) => props.onUpdate(e));\n                    }\n                }\n            };\n\n            if (pages.length > 0 && childRef.current.length > 0) {\n                removeHandlers();\n\n                if (htmlElementRef.current && !pageFlip.current) {\n                    pageFlip.current = new PageFlip(htmlElementRef.current, props);\n                }\n\n                if (!pageFlip.current.getFlipController()) {\n                    pageFlip.current.loadFromHTML(childRef.current);\n                } else {\n                    pageFlip.current.updateFromHtml(childRef.current);\n                }\n\n                setHandlers();\n            }\n            // eslint-disable-next-line react-hooks/exhaustive-deps\n        }, [pages]);\n\n        return (\n            <div ref={htmlElementRef} className={props.className} style={props.style}>\n                {pages}\n            </div>\n        );\n    }\n);\n\nexport const HTMLFlipBook = React.memo(HTMLFlipBookForward);\n"],"names":["React","useRef","pageFlip","useState","useImperativeHandle","useCallback","useEffect","PageFlip"],"mappings":"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"}